.lnbuf:		.long	0
.lnbuf_len: 	.long	0


# Read up to 1024 bytes from stdin
readln:
	# Continue with .lnbuf if .lnbuf_len is not 0, otherwise read
	load	r5,.lnbuf_len
	jnz	.findnl,r5
	# Allocate 1K+8 buffer
	set	r0,1032
	call	alloc
	# Increase pointer
	set	r4,8
	add	r0,r0,r1
	# Read
	set	r3,1024		# Length of buffer
	mov	r2,r0		# Buffer
	xor	r1,r1,r1	# stdin ( = 0)
	set	r0,2		# SYS_read
	syscall
	# Find end of line
	#xor	r1,r1,r1	# r1 is already 0
.findnl:
	
	loadb	r7,r0
	jmp	.findnl
	# Decrease pointer and store length
	sub	r1,r2,r4
	storel	r0,r1
	# Return array 
	mov	r0,r1
	ret
